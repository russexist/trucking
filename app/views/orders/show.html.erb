<div class="jumbotron">
  <p class="lead">
    <p>
      <strong><%= t('.starting_point') %>:</strong> <%= @order.starting_point %>
      <%= button_to t('common.edit'), edit_start_path(@order.start), method: :get, class: "btn btn-info" unless current_user.driver  %>
    </p>
    <p>
      <strong><%= t('.destination_point') %>:</strong>  <%= @order.destination_point %>
      <%= button_to t('common.edit'), edit_destination_path(@order.destination), method: :get, class: "btn btn-info" unless current_user.driver  %>
    </p>
  </p>
  <hr class="my-4">
  <p><%= t('.price') %>: <%= format_uah(@order.price) %></p>
  <p><%= t('.date') %>: <%= @order.date %></p>
  <p><%= t('.weight') %>: <%= format_weight(@order.weight) %></p>
  <p><%= t('.status') %>: <%= @order.status %></p>
  <p><%= t('.comment') %>: <%= @order.comment %></p>

  <% if @driver.present? %>
    <% if current_user.driver %>
      <p><%= t('common.accepted_order_driver') %></p>
    <% else %>
      <p><%= t('common.accepted_order_user') %>: <%= link_to "#{@driver.first_name} #{@driver.last_name}", profile_path(driver: @driver) %></p>
    <% end %>
  <% end %>

  <p class="lead">
    <% if current_user.driver %>
      <% if @order.status.match(t('status.accepted')) %>
        <%= link_to t('common.delivered'), archive_orders_path(id: @order, status: 2, driver_id: current_user), method: :post, class: "btn btn-info" %>
        <%= link_to t('common.refuse'), change_status_path(id: @order, status: 0, driver_id: nil), class: "btn btn-info" %>
      <% else %>
        <%= link_to t('common.take_order'), change_status_path(id: @order, status: 1, driver_id: current_user), class: "btn btn-info" %>
      <% end %>
    <% else %>
      <%= link_to t('common.edit'), edit_order_path(@order), class: "btn btn-info" %>
      <%= link_to t('common.delete'), start_path(@order.start), method: :delete, data: { confirm: 'Вы уверены?' }, class: "btn btn-info" %>
    <% end %>
  </p>
  <div id="map"></div>
</div>

<script>
  function initMap() {
    var directionsService = new google.maps.DirectionsService;
    var directionsDisplay = new google.maps.DirectionsRenderer;
    var map = new google.maps.Map(document.getElementById('map'), {
      zoom: 9,
      center: {lat: 49.0, lng: 32.0}
    });
    directionsDisplay.setMap(map);

    var onChangeHandler = function() {
      calculateAndDisplayRoute(directionsService, directionsDisplay);
    };
    onChangeHandler();
  }

  function calculateAndDisplayRoute(directionsService, directionsDisplay) {
    directionsService.route({
      origin: '<%= @order.starting_point %>',
      destination: '<%= @order.destination_point %>',
      travelMode: 'DRIVING'
    }, function(response, status) {
      if (status === 'OK') {
        directionsDisplay.setDirections(response);
      } else {
        window.alert('Directions request failed due to ' + status);
      }
    });
  }
</script>
<script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDjgTe57M-Jmvs1PfRM-a5xHQy9XTrTUlw&callback=initMap">
</script>
